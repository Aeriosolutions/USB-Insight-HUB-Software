import{s as V,e as j,n as B,h as X,b as O,r as Be}from"../chunks/utils.js";import{q as we,H as be,r as ve,g as x,u as $e,d,v as Y,i as D,b,s as N,f as v,c as P,C as H,h,w,y as Q,e as se,x as Ae,B as Se,k as ie,l as oe}from"../chunks/scheduler.js";import{S as z,i as L,b as A,d as S,m as M,a as g,t as $,e as I,g as J,c as K,p as ce}from"../chunks/index.js";import{o as q,X as ke,a as ye,C as xe,b as Me,c as Ie}from"../chunks/ConfirmDialog.js";import{g as Ce,u as W,c as ue,s as fe}from"../chunks/index2.js";import{p as Z}from"../chunks/stores.js";import{S as Ee}from"../chunks/SettingsCard.js";import{A as Ue}from"../chunks/alert-triangle.js";import{h as Fe,u as Ne}from"../chunks/await_block.js";import{e as de}from"../chunks/each.js";import{S as Pe}from"../chunks/Spinner.js";import{B as Ge,a as De,G as je,C as Oe,c as R}from"../chunks/compareVersions.js";import"../chunks/singletons.js";import{I as Ve}from"../chunks/InfoDialog.js";const He=async()=>({title:"Firmware Update"}),Et=Object.freeze(Object.defineProperty({__proto__:null,load:He},Symbol.toStringTag,{value:"Module"}));function ze(i){let e,r,t='<g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2zm-5-10v6"/><path d="M9.5 13.5L12 11l2.5 2.5"/></g>',a=[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},i[0]],s={};for(let l=0;l<a.length;l+=1)s=j(s,a[l]);return{c(){e=we("svg"),r=new be(!0),this.h()},l(l){e=ve(l,"svg",{viewBox:!0,width:!0,height:!0});var n=x(e);r=$e(n,!0),n.forEach(d),this.h()},h(){r.a=null,Y(e,s)},m(l,n){D(l,e,n),r.m(t,e)},p(l,[n]){Y(e,s=Ce(a,[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},n&1&&l[0]]))},i:B,o:B,d(l){l&&d(e)}}}function Le(i,e,r){return i.$$set=t=>{r(0,e=j(j({},e),X(t)))},e=X(e),[e]}class Te extends z{constructor(e){super(),L(this,e,Le,ze,V,{})}}function Re(i){let e,r,t,a,s=`Uploading a new firmware (.bin) file will replace the existing firmware. You may upload a
			(.md5) file first to verify the uploaded firmware.`,l,n,u,c,p;return r=new Ue({props:{class:"h-6 w-6 flex-shrink-0"}}),{c(){e=b("div"),A(r.$$.fragment),t=N(),a=b("span"),a.textContent=s,l=N(),n=b("input"),this.h()},l(o){e=v(o,"DIV",{class:!0});var y=x(e);S(r.$$.fragment,y),t=P(y),a=v(y,"SPAN",{"data-svelte-h":!0}),H(a)!=="svelte-1g05xjv"&&(a.textContent=s),y.forEach(d),l=P(o),n=v(o,"INPUT",{type:!0,id:!0,class:!0,accept:!0}),this.h()},h(){h(e,"class","alert alert-warning shadow-lg"),h(n,"type","file"),h(n,"id","binFile"),h(n,"class","file-input file-input-bordered file-input-secondary mt-4 w-full"),h(n,"accept",".bin,.md5")},m(o,y){D(o,e,y),M(r,e,null),w(e,t),w(e,a),D(o,l,y),D(o,n,y),u=!0,c||(p=[Q(n,"change",i[2]),Q(n,"change",i[1])],c=!0)},p:B,i(o){u||(g(r.$$.fragment,o),u=!0)},o(o){$(r.$$.fragment,o),u=!1},d(o){o&&(d(e),d(l),d(n)),I(r),c=!1,Be(p)}}}function qe(i){let e,r;return e=new Te({props:{slot:"icon",class:"lex-shrink-0 mr-2 h-6 w-6 self-end rounded-full"}}),{c(){A(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,a){M(e,t,a),r=!0},p:B,i(t){r||(g(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function Xe(i){let e,r="Upload Firmware";return{c(){e=b("span"),e.textContent=r,this.h()},l(t){e=v(t,"SPAN",{slot:!0,"data-svelte-h":!0}),H(e)!=="svelte-18zv7sf"&&(e.textContent=r),this.h()},h(){h(e,"slot","title")},m(t,a){D(t,e,a)},p:B,d(t){t&&d(e)}}}function Ye(i){let e,r;return e=new Ee({props:{collapsible:!1,$$slots:{title:[Xe],icon:[qe],default:[Re]},$$scope:{ctx:i}}}),{c(){A(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,a){M(e,t,a),r=!0},p(t,[a]){const s={};a&65&&(s.$$scope={dirty:a,ctx:t}),e.$set(s)},i(t){r||(g(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function Je(i,e,r){let t,a;O(i,W,c=>r(3,t=c)),O(i,Z,c=>r(4,a=c));let s;async function l(){try{const c=new FormData;c.append("file",s[0]);const o=await(await fetch("/rest/uploadFirmware",{method:"POST",headers:{Authorization:a.data.features.security?"Bearer "+t.bearer_token:"Basic"},body:c})).json()}catch(c){console.error("Error:",c)}}function n(){q(xe,{title:"Confirm Flashing the Device",message:"Are you sure you want to overwrite the existing firmware with a new one?",labels:{cancel:{label:"Abort",icon:ke},confirm:{label:"Upload",icon:Te}},onConfirm:()=>{ye(),l()}})}function u(){s=this.files,r(0,s)}return[s,n,u]}class Ke extends z{constructor(e){super(),L(this,e,Je,Ye,V,{})}}function Qe(i){let e,r,t='<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 8.04L7.878 20.164a2.857 2.857 0 1 1-4.041-4.04L15.959 4M7 13h8m4 2l1.5 1.6a2 2 0 1 1-3 0L19 15zM15 3l6 6"/>',a=[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},i[0]],s={};for(let l=0;l<a.length;l+=1)s=j(s,a[l]);return{c(){e=we("svg"),r=new be(!0),this.h()},l(l){e=ve(l,"svg",{viewBox:!0,width:!0,height:!0});var n=x(e);r=$e(n,!0),n.forEach(d),this.h()},h(){r.a=null,Y(e,s)},m(l,n){D(l,e,n),r.m(t,e)},p(l,[n]){Y(e,s=Ce(a,[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},n&1&&l[0]]))},i:B,o:B,d(l){l&&d(e)}}}function We(i,e,r){return i.$$set=t=>{r(0,e=j(j({},e),X(t)))},e=X(e),[e]}class Ze extends z{constructor(e){super(),L(this,e,We,Qe,V,{})}}function me(i,e,r){const t=i.slice();return t[7]=e[r],t}function et(i){let e,r,t,a,s="Please connect to a network with internet access to perform a firmware update.",l;return r=new Oe({props:{class:"h-6 w-6 flex-shrink-0"}}),{c(){e=b("div"),A(r.$$.fragment),t=N(),a=b("span"),a.textContent=s,this.h()},l(n){e=v(n,"DIV",{class:!0});var u=x(e);S(r.$$.fragment,u),t=P(u),a=v(u,"SPAN",{"data-svelte-h":!0}),H(a)!=="svelte-1x97k7m"&&(a.textContent=s),u.forEach(d),this.h()},h(){h(e,"class","alert alert-error shadow-lg")},m(n,u){D(n,e,u),M(r,e,null),w(e,t),w(e,a),l=!0},p:B,i(n){l||(g(r.$$.fragment,n),l=!0)},o(n){$(r.$$.fragment,n),l=!1},d(n){n&&d(e),I(r)}}}function tt(i){let e,r,t,a,s='<tr class="font-bold"><th align="left">Release</th> <th align="center" class="hidden sm:block">Release Date</th> <th align="center">Experimental</th> <th align="center">Install</th></tr>',l,n,u,c,p=de(i[6]),o=[];for(let f=0;f<p.length;f+=1)o[f]=ge(me(i,p,f));const y=f=>$(o[f],1,1,()=>{o[f]=null});return{c(){e=b("div"),r=b("div"),t=b("table"),a=b("thead"),a.innerHTML=s,l=N(),n=b("tbody");for(let f=0;f<o.length;f+=1)o[f].c();this.h()},l(f){e=v(f,"DIV",{class:!0});var _=x(e);r=v(_,"DIV",{class:!0});var m=x(r);t=v(m,"TABLE",{class:!0});var T=x(t);a=v(T,"THEAD",{"data-svelte-h":!0}),H(a)!=="svelte-yq4ktl"&&(a.innerHTML=s),l=P(T),n=v(T,"TBODY",{});var G=x(n);for(let F=0;F<o.length;F+=1)o[F].l(G);G.forEach(d),T.forEach(d),m.forEach(d),_.forEach(d),this.h()},h(){h(t,"class","table w-full table-auto"),h(r,"class","overflow-x-auto"),h(e,"class","relative w-full overflow-visible")},m(f,_){D(f,e,_),w(e,r),w(r,t),w(t,a),w(t,l),w(t,n);for(let m=0;m<o.length;m+=1)o[m]&&o[m].m(n,null);c=!0},p(f,_){if(_&7){p=de(f[6]);let m;for(m=0;m<p.length;m+=1){const T=me(f,p,m);o[m]?(o[m].p(T,_),g(o[m],1)):(o[m]=ge(T),o[m].c(),g(o[m],1),o[m].m(n,null))}for(J(),m=p.length;m<o.length;m+=1)y(m);K()}},i(f){if(!c){for(let _=0;_<p.length;_+=1)g(o[_]);f&&Ae(()=>{c&&(u||(u=ce(r,fe,{duration:300,easing:ue},!0)),u.run(1))}),c=!0}},o(f){o=o.filter(Boolean);for(let _=0;_<o.length;_+=1)$(o[_]);f&&(u||(u=ce(r,fe,{duration:300,easing:ue},!1)),u.run(0)),c=!1},d(f){f&&d(e),Se(o,f),f&&u&&u.end()}}}function rt(i){let e,r;return e=new Ze({props:{class:"text-accent h-5 w-5"}}),{c(){A(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,a){M(e,t,a),r=!0},i(t){r||(g(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function he(i){let e,r,t,a,s;r=new De({props:{class:"text-secondary h-6 w-6"}});function l(){return i[3](i[7])}return{c(){e=b("button"),A(r.$$.fragment),this.h()},l(n){e=v(n,"BUTTON",{class:!0});var u=x(e);S(r.$$.fragment,u),u.forEach(d),this.h()},h(){h(e,"class","btn btn-ghost btn-circle btn-sm")},m(n,u){D(n,e,u),M(r,e,null),t=!0,a||(s=Q(e,"click",l),a=!0)},p(n,u){i=n},i(n){t||(g(r.$$.fragment,n),t=!0)},o(n){$(r.$$.fragment,n),t=!1},d(n){n&&d(e),I(r),a=!1,s()}}}function ge(i){let e,r,t,a=i[7].name+"",s,l,n,u,c=new Intl.DateTimeFormat("en-GB",{dateStyle:"medium"}).format(new Date(i[7].published_at))+"",p,o,y,f,_,m=R(i[0].data.features.firmware_version,i[7].tag_name)!=0,T,G,F,U=i[7].prerelease&&rt(),k=m&&he(i);return{c(){e=b("tr"),r=b("td"),t=b("a"),s=ie(a),l=N(),n=b("td"),u=b("div"),p=ie(c),o=N(),y=b("td"),U&&U.c(),f=N(),_=b("td"),k&&k.c(),T=N(),this.h()},l(E){e=v(E,"TR",{class:!0});var C=x(e);r=v(C,"TD",{align:!0,class:!0});var ee=x(r);t=v(ee,"A",{href:!0,class:!0,target:!0,rel:!0});var te=x(t);s=oe(te,a),te.forEach(d),ee.forEach(d),l=P(C),n=v(C,"TD",{align:!0,class:!0});var re=x(n);u=v(re,"DIV",{class:!0});var ae=x(u);p=oe(ae,c),ae.forEach(d),re.forEach(d),o=P(C),y=v(C,"TD",{align:!0});var ne=x(y);U&&U.l(ne),ne.forEach(d),f=P(C),_=v(C,"TD",{align:!0});var le=x(_);k&&k.l(le),le.forEach(d),T=P(C),C.forEach(d),this.h()},h(){h(t,"href",i[7].html_url),h(t,"class","link link-hover"),h(t,"target","_blank"),h(t,"rel","noopener noreferrer"),h(r,"align","left"),h(r,"class","text-base font-semibold"),h(u,"class","my-2"),h(n,"align","center"),h(n,"class","hidden min-h-full align-middle sm:block"),h(y,"align","center"),h(_,"align","center"),h(e,"class",G=R(i[0].data.features.firmware_version,i[7].tag_name)===0?"bg-primary text-primary-content":"bg-base-100 h-14")},m(E,C){D(E,e,C),w(e,r),w(r,t),w(t,s),w(e,l),w(e,n),w(n,u),w(u,p),w(e,o),w(e,y),U&&U.m(y,null),w(e,f),w(e,_),k&&k.m(_,null),w(e,T),F=!0},p(E,C){C&1&&(m=R(E[0].data.features.firmware_version,E[7].tag_name)!=0),m?k?(k.p(E,C),C&1&&g(k,1)):(k=he(E),k.c(),g(k,1),k.m(_,null)):k&&(J(),$(k,1,1,()=>{k=null}),K()),(!F||C&1&&G!==(G=R(E[0].data.features.firmware_version,E[7].tag_name)===0?"bg-primary text-primary-content":"bg-base-100 h-14"))&&h(e,"class",G)},i(E){F||(g(U),g(k),F=!0)},o(E){$(U),$(k),F=!1},d(E){E&&d(e),U&&U.d(),k&&k.d()}}}function at(i){let e,r;return e=new Pe({}),{c(){A(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,a){M(e,t,a),r=!0},p:B,i(t){r||(g(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function nt(i){let e,r,t={ctx:i,current:null,token:null,hasCatch:!0,pending:at,then:tt,catch:et,value:6,error:10,blocks:[,,,]};return Fe(i[1](),t),{c(){e=se(),t.block.c()},l(a){e=se(),t.block.l(a)},m(a,s){D(a,e,s),t.block.m(a,t.anchor=s),t.mount=()=>e.parentNode,t.anchor=e,r=!0},p(a,s){i=a,Ne(t,i,s)},i(a){r||(g(t.block),r=!0)},o(a){for(let s=0;s<3;s+=1){const l=t.blocks[s];$(l)}r=!1},d(a){a&&d(e),t.block.d(a),t.token=null,t=null}}}function lt(i){let e,r;return e=new Ge({props:{slot:"icon",class:"lex-shrink-0 mr-2 h-6 w-6 self-end rounded-full"}}),{c(){A(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,a){M(e,t,a),r=!0},p:B,i(t){r||(g(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function st(i){let e,r="Github Firmware Manager";return{c(){e=b("span"),e.textContent=r,this.h()},l(t){e=v(t,"SPAN",{slot:!0,"data-svelte-h":!0}),H(e)!=="svelte-1iezg3y"&&(e.textContent=r),this.h()},h(){h(e,"slot","title")},m(t,a){D(t,e,a)},p:B,d(t){t&&d(e)}}}function it(i){let e,r;return e=new Ee({props:{collapsible:!1,$$slots:{title:[st],icon:[lt],default:[nt]},$$scope:{ctx:i}}}),{c(){A(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,a){M(e,t,a),r=!0},p(t,[a]){const s={};a&2049&&(s.$$scope={dirty:a,ctx:t}),e.$set(s)},i(t){r||(g(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function ot(i,e,r){let t,a;O(i,Z,c=>r(0,t=c)),O(i,W,c=>r(4,a=c));async function s(){try{return await(await fetch("https://api.github.com/repos/"+t.data.github+"/releases",{method:"GET",headers:{accept:"application/vnd.github+json","X-GitHub-Api-Version":"2022-11-28"}})).json()}catch(c){console.error("Error:",c)}}async function l(c){try{const p=await fetch("/rest/downloadUpdate",{method:"POST",headers:{Authorization:t.data.features.security?"Bearer "+a.bearer_token:"Basic","Content-Type":"application/json"},body:JSON.stringify({download_url:c})})}catch(p){console.error("Error:",p)}}function n(c){let p="";for(let o=0;o<c.length;o++)c[o].name.includes(".bin")&&c[o].name.includes(t.data.features.firmware_built_target)&&(p=c[o].browser_download_url);if(p===""){q(Ve,{title:"No matching firmware found",message:"No matching firmware was found for the current device. Upload the firmware manually or build from sources.",dismiss:{label:"OK",icon:Me},onDismiss:()=>ye()});return}q(xe,{title:"Confirm flashing new firmware to the device",message:"Are you sure you want to overwrite the existing firmware with a new one?",labels:{cancel:{label:"Abort",icon:ke},confirm:{label:"Update",icon:De}},onConfirm:()=>{l(p),q(je,{onConfirm:()=>Ie()})}})}return[t,s,n,c=>{n(c.assets)}]}class ct extends z{constructor(e){super(),L(this,e,ot,it,V,{})}}function pe(i){let e,r;return e=new ct({}),{c(){A(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,a){M(e,t,a),r=!0},i(t){r||(g(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function _e(i){let e,r;return e=new Ke({}),{c(){A(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,a){M(e,t,a),r=!0},i(t){r||(g(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function ut(i){let e,r,t,a=i[0].data.features.download_firmware&&(!i[0].data.features.security||i[1].admin)&&pe(),s=i[0].data.features.upload_firmware&&(!i[0].data.features.security||i[1].admin)&&_e();return{c(){e=b("div"),a&&a.c(),r=N(),s&&s.c(),this.h()},l(l){e=v(l,"DIV",{class:!0});var n=x(e);a&&a.l(n),r=P(n),s&&s.l(n),n.forEach(d),this.h()},h(){h(e,"class","mx-0 my-1 flex flex-col space-y-4 sm:mx-8 sm:my-8")},m(l,n){D(l,e,n),a&&a.m(e,null),w(e,r),s&&s.m(e,null),t=!0},p(l,[n]){l[0].data.features.download_firmware&&(!l[0].data.features.security||l[1].admin)?a?n&3&&g(a,1):(a=pe(),a.c(),g(a,1),a.m(e,r)):a&&(J(),$(a,1,1,()=>{a=null}),K()),l[0].data.features.upload_firmware&&(!l[0].data.features.security||l[1].admin)?s?n&3&&g(s,1):(s=_e(),s.c(),g(s,1),s.m(e,null)):s&&(J(),$(s,1,1,()=>{s=null}),K())},i(l){t||(g(a),g(s),t=!0)},o(l){$(a),$(s),t=!1},d(l){l&&d(e),a&&a.d(),s&&s.d()}}}function ft(i,e,r){let t,a;O(i,Z,l=>r(0,t=l)),O(i,W,l=>r(1,a=l));let{data:s}=e;return i.$$set=l=>{"data"in l&&r(2,s=l.data)},[t,a,s]}class Dt extends z{constructor(e){super(),L(this,e,ft,ut,V,{data:2})}}export{Dt as component,Et as universal};
